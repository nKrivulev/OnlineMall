<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ–¥—É–∫—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–∞</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .product-container {
            max-width: 1100px;
            margin: 5rem auto;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .product-container h1 {
            text-align: center;
            margin-bottom: 2rem;
            color: #333;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        #addProductSection {
            margin-top: 3rem;
            padding: 2rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        #addProductSection input {
            width: 100%;
            padding: 0.7rem;
            margin: 0.5rem 0;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
        }

        #addProductSection button {
            margin-top: 0.5rem;
            padding: 0.7rem 1.5rem;
            background-color: #007bff;
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
        }

        #addProductSection button:hover {
            background-color: #0056b3;
        }

        .back-link {
            text-align: center;
            margin-top: 2rem;
        }

        .back-link a {
            color: #007bff;
            text-decoration: none;
        }

        .back-link a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
<div id="navbar-container"></div>

<div class="product-container">
    <h1 id="storeTitle">–ü—Ä–æ–¥—É–∫—Ç–∏</h1>
    <div id="productList" class="grid"></div>

    <div id="addProductSection" style="display: none;">
        <h2>–î–æ–±–∞–≤–∏ –ø—Ä–æ–¥—É–∫—Ç</h2>
        <input type="text" id="productName" placeholder="–ò–º–µ" required>
        <input type="text" id="productDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
        <input type="number" id="productPrice" placeholder="–¶–µ–Ω–∞" min="0" required>
        <input type="text" id="productImage" placeholder="Image URL">
        <button onclick="addProduct()">–î–æ–±–∞–≤–∏</button>
    </div>

    <div class="back-link">
        <a href="stores.html">‚¨Ö –ù–∞–∑–∞–¥ –∫—ä–º –º–∞–≥–∞–∑–∏–Ω–∏—Ç–µ</a>
    </div>
</div>

<script src="script.js"></script>
<script>
    const storeId = new URLSearchParams(window.location.search).get('storeId');

    async function loadProducts() {
        const res = await fetch(`${API}/stores/${storeId}/products`);
        const data = await res.json();

        const container = document.getElementById("productList");
        container.innerHTML = "";

        data.forEach(p => {
            const el = document.createElement("div");
            el.className = "card";
            el.innerHTML = `
                <h3>${p.name}</h3>
                <img src="${p.imageUrl}" alt="${p.name}" width="150">
                <p>${p.description}</p>
                <p><strong>–¶–µ–Ω–∞:</strong> ${p.price.toFixed(2)} –ª–≤.</p>
                <button onclick="addToCart(${p.id})">–î–æ–±–∞–≤–∏ –≤ –∫–æ–ª–∏—á–∫–∞—Ç–∞</button>
                <a href="reviews.html" onclick="localStorage.setItem('currentProductId', ${p.id})">üìù –í–∏–∂ –æ—Ç–∑–∏–≤–∏</a>
            `;
            container.appendChild(el);
        });
    }

    async function checkIfSeller() {
        const user = await getCurrentUser();
        if (user && user.role === "SELLER") {
            document.getElementById("addProductSection").style.display = "block";
        }
    }

    async function addProduct() {
        const data = {
            name: document.getElementById("productName").value,
            description: document.getElementById("productDesc").value,
            price: parseFloat(document.getElementById("productPrice").value),
            imageUrl: document.getElementById("productImage").value
        };

        const res = await fetch(`${API}/stores/${storeId}/products`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });

        if (res.ok) {
            alert("–ü—Ä–æ–¥—É–∫—Ç—ä—Ç –µ –¥–æ–±–∞–≤–µ–Ω!");
            loadProducts();
        } else {
            alert("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤—è–Ω–µ.");
        }
    }

    loadProducts();
    checkIfSeller();
</script>
</body>
</html>