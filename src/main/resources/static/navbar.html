<div class="navbar">
    <a href="index.html">🏠 Начало</a>
    <a href="stores.html">🛍️ Магазини</a>
    <a href="cart.html" id="cartLink" style="display:none;">🛒 Количка</a>
    <a href="profile.html" id="profileLink" style="display:none;">👤 Профил</a>
    <a href="admin.html" id="adminLink" style="display:none;">🛡️ Админ</a>
    <a href="login.html" id="loginLink">🔐 Вход</a>
    <a href="register.html" id="registerLink">📝 Регистрация</a>
    <a href="#" onclick="logout()" id="logoutLink" style="display:none;">🚪 Изход</a>
</div>

<script>
    document.addEventListener("DOMContentLoaded", async () => {
        const user = await getCurrentUser();
        if (user) {
            document.getElementById("loginLink").style.display = "none";
            document.getElementById("registerLink").style.display = "none";
            document.getElementById("logoutLink").style.display = "inline";
            document.getElementById("profileLink").style.display = "inline";
            document.getElementById("cartLink").style.display = "inline";
            if (user.role === "ADMIN") {
                document.getElementById("adminLink").style.display = "inline";
            }
        }
    });

    async function getCurrentUser() {
        try {
            const res = await fetch("/api/users/me", {
                method: "GET",
                credentials: "include",
                headers: {
                    "Accept": "application/json"
                }
            });

            if (res.ok) {
                return await res.json();
            }
        } catch (e) {
            console.error("Грешка при взимане на потребителя:", e);
        }

        return null;
    }

    function logout() {
        fetch("/logout", { method: "POST" })
            .then(() => location.href = "/login.html");
    }
</script>
